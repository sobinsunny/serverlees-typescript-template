{"version":3,"sources":["../../../lib/interactiveCli/writeTenantAndApp.js"],"names":["path","require","readFile","writeFile","getServerlessFilePath","yamlExtensions","Set","module","exports","serverless","tenantName","appName","serverlessFileName","processedInput","options","config","servicePath","ymlString","has","extname","error","code","process","stdout","write","toString","match","replace","service","tenant","app","enterpriseEnabled"],"mappings":"AAAA;;;;;;AAEA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;iBACgCA,OAAO,CAAC,UAAD,C;MAA/BC,Q,YAAAA,Q;MAAUC,S,YAAAA,S;;AAClB,MAAMC,qBAAqB,GAAGH,OAAO,CAAC,qCAAD,CAArC;;AAEA,MAAMI,cAAc,GAAG,IAAIC,GAAJ,CAAQ,CAAC,MAAD,EAAS,OAAT,CAAR,CAAvB;;AAEAC,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,+BAAiB,WAAOC,UAAP,EAAmBC,UAAnB,EAA+BC,OAA/B,EAA2C;AAC1D,UAAMC,kBAAkB,SAASR,qBAAqB,CACpDK,UAAU,CAACI,cAAX,CAA0BC,OAA1B,CAAkCC,MADkB,EAEpDN,UAAU,CAACM,MAAX,CAAkBC,WAFkC,CAAtD;AAKA,QAAIC,SAAS,SAAS,kBAAC,aAAY;AACjC,UAAI,CAACZ,cAAc,CAACa,GAAf,CAAmBlB,IAAI,CAACmB,OAAL,CAAaP,kBAAb,CAAnB,CAAL,EAA2D,OAAO,IAAP,CAD1B,CACuC;;AACxE,UAAI;AACF,qBAAaV,QAAQ,CAACU,kBAAD,CAArB;AACD,OAFD,CAEE,OAAOQ,KAAP,EAAc;AACd,YAAIA,KAAK,CAACC,IAAN,KAAe,QAAnB,EAA6B,OAAO,IAAP;AAC7B,cAAMD,KAAN;AACD;AACF,KARqB,GAAtB;;AAUA,QAAI,CAACH,SAAL,EAAgB;AACdK,MAAAA,OAAO,CAACC,MAAR,CAAeC,KAAf,CACE,0EACG,QAAOd,UAAW,UAASC,OAAQ,IAFxC;AAIA;AACD;;AACDM,IAAAA,SAAS,GAAGA,SAAS,CAACQ,QAAV,EAAZ;;AACA,QAAIR,SAAS,CAACS,KAAV,CAAgB,yBAAhB,CAAJ,EAAgD;AAC9CT,MAAAA,SAAS,GAAGA,SAAS,CAACU,OAAV,CAAkB,yBAAlB,EAA8C,QAAOhB,OAAQ,EAA7D,CAAZ;AACD,KAFD,MAEO;AACLM,MAAAA,SAAS,GAAI,QAAON,OAAQ,KAAIM,SAAU,EAA1C;AACD;;AACD,QAAIA,SAAS,CAACS,KAAV,CAAgB,yBAAhB,CAAJ,EAAgD;AAC9CT,MAAAA,SAAS,GAAGA,SAAS,CAACU,OAAV,CAAkB,yBAAlB,EAA8C,QAAOjB,UAAW,EAAhE,CAAZ;AACD,KAFD,MAEO,IAAIO,SAAS,CAACS,KAAV,CAAgB,4BAAhB,CAAJ,EAAmD;AACxDT,MAAAA,SAAS,GAAGA,SAAS,CAACU,OAAV,CAAkB,4BAAlB,EAAiD,QAAOjB,UAAW,EAAnE,CAAZ;AACD,KAFM,MAEA;AACLO,MAAAA,SAAS,GAAI,QAAOP,UAAW,KAAIO,SAAU,EAA7C;AACD;;AACD,UAAMd,SAAS,CAACS,kBAAD,EAAqBK,SAArB,CAAf;AACAR,IAAAA,UAAU,CAACmB,OAAX,CAAmBC,MAAnB,GAA4BnB,UAA5B;AACAD,IAAAA,UAAU,CAACmB,OAAX,CAAmBE,GAAnB,GAAyBnB,OAAzB;AACAF,IAAAA,UAAU,CAACsB,iBAAX,GAA+B,IAA/B;AACD,GAxCD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["'use strict';\n\nconst path = require('path');\nconst { readFile, writeFile } = require('fs-extra');\nconst getServerlessFilePath = require('../deployment/getServerlessFilePath');\n\nconst yamlExtensions = new Set(['.yml', '.yaml']);\n\nmodule.exports = async (serverless, tenantName, appName) => {\n  const serverlessFileName = await getServerlessFilePath(\n    serverless.processedInput.options.config,\n    serverless.config.servicePath\n  );\n\n  let ymlString = await (async () => {\n    if (!yamlExtensions.has(path.extname(serverlessFileName))) return null; // Non YAML config\n    try {\n      return await readFile(serverlessFileName);\n    } catch (error) {\n      if (error.code === 'ENOENT') return null;\n      throw error;\n    }\n  })();\n\n  if (!ymlString) {\n    process.stdout.write(\n      'Add the following settings to your serverless configuration file:\\n\\n' +\n        `org: ${tenantName}\\napp: ${appName}\\n`\n    );\n    return;\n  }\n  ymlString = ymlString.toString();\n  if (ymlString.match(/^\\s*#?\\s*app\\s*:\\s+.*$/m)) {\n    ymlString = ymlString.replace(/^\\s*#?\\s*app\\s*:\\s+.*$/m, `app: ${appName}`);\n  } else {\n    ymlString = `app: ${appName}\\n${ymlString}`;\n  }\n  if (ymlString.match(/^\\s*#?\\s*org\\s*:\\s+.*$/m)) {\n    ymlString = ymlString.replace(/^\\s*#?\\s*org\\s*:\\s+.*$/m, `org: ${tenantName}`);\n  } else if (ymlString.match(/^\\s*#?\\s*tenant\\s*:\\s+.*$/m)) {\n    ymlString = ymlString.replace(/^\\s*#?\\s*tenant\\s*:\\s+.*$/m, `org: ${tenantName}`);\n  } else {\n    ymlString = `org: ${tenantName}\\n${ymlString}`;\n  }\n  await writeFile(serverlessFileName, ymlString);\n  serverless.service.tenant = tenantName;\n  serverless.service.app = appName;\n  serverless.enterpriseEnabled = true;\n};\n"],"file":"writeTenantAndApp.js"}