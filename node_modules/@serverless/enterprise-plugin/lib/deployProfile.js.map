{"version":3,"sources":["../../lib/deployProfile.js"],"names":["_","require","getAccessKeyForTenant","getDeployProfile","module","exports","configureDeployProfile","ctx","accessKey","sls","service","tenant","deploymentProfile","stage","provider","getStage","pick","providerCredentials","cachedCredentials","secretValue","region","getRegion","safeguards","safeguardsPolicies"],"mappings":"AAAA;;;;;;;;;;;;AAEA,MAAMA,CAAC,GAAGC,OAAO,CAAC,QAAD,CAAjB;;iBACoDA,OAAO,CAAC,0BAAD,C;MAAnDC,qB,YAAAA,qB;MAAuBC,gB,YAAAA,gB;;AAE/BC,MAAM,CAACC,OAAP,CAAeC,sBAAf;AAAA;AAAA;AAAA,+BAAwC,WAAMC,GAAN,EAAa;AACnD,UAAMC,SAAS,SAASN,qBAAqB,CAACK,GAAG,CAACE,GAAJ,CAAQC,OAAR,CAAgBC,MAAjB,CAA7C;AACA,UAAMC,iBAAiB,SAAST,gBAAgB;AAC9CK,MAAAA,SAD8C;AAE9CK,MAAAA,KAAK,EAAEN,GAAG,CAACO,QAAJ,CAAaC,QAAb;AAFuC,OAG3Cf,CAAC,CAACgB,IAAF,CAAOT,GAAG,CAACE,GAAJ,CAAQC,OAAf,EAAwB,CAAC,QAAD,EAAW,KAAX,EAAkB,SAAlB,CAAxB,CAH2C,EAAhD;;AAKA,QAAIE,iBAAiB,CAACK,mBAAtB,EAA2C;AACzCV,MAAAA,GAAG,CAACO,QAAJ,CAAaI,iBAAb,GAAiCN,iBAAiB,CAACK,mBAAlB,CAAsCE,WAAvE;AACAZ,MAAAA,GAAG,CAACO,QAAJ,CAAaI,iBAAb,CAA+BE,MAA/B,GAAwCb,GAAG,CAACO,QAAJ,CAAaO,SAAb,EAAxC;AACD;;AACDd,IAAAA,GAAG,CAACe,UAAJ,GAAiBV,iBAAiB,CAACW,kBAAnC;AACD,GAZD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["'use strict';\n\nconst _ = require('lodash');\nconst { getAccessKeyForTenant, getDeployProfile } = require('@serverless/platform-sdk');\n\nmodule.exports.configureDeployProfile = async ctx => {\n  const accessKey = await getAccessKeyForTenant(ctx.sls.service.tenant);\n  const deploymentProfile = await getDeployProfile({\n    accessKey,\n    stage: ctx.provider.getStage(),\n    ..._.pick(ctx.sls.service, ['tenant', 'app', 'service']),\n  });\n  if (deploymentProfile.providerCredentials) {\n    ctx.provider.cachedCredentials = deploymentProfile.providerCredentials.secretValue;\n    ctx.provider.cachedCredentials.region = ctx.provider.getRegion();\n  }\n  ctx.safeguards = deploymentProfile.safeguardsPolicies;\n};\n"],"file":"deployProfile.js"}