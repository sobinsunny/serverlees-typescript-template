{"version":3,"sources":["../../lib/credentials.js"],"names":["require","getCredentials","getAccessKeyForTenant","module","exports","ctx","process","env","SLS_CLOUD_ACCESS","accessKey","sls","service","tenant","stageName","provider","getStage","command","processedInput","commands","app","getServiceName","accessKeyId","secretAccessKey","sessionToken","AWS_ACCESS_KEY_ID","AWS_SECRET_ACCESS_KEY","AWS_SESSION_TOKEN","cli","log"],"mappings":"AAAA;;;;;;iBAEkDA,OAAO,CAAC,0BAAD,C;MAAjDC,c,YAAAA,c;MAAgBC,qB,YAAAA,qB;;AAExBC,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,+BAAiB,WAAeC,GAAf,EAAoB;AACnC,QAAI,CAACC,OAAO,CAACC,GAAR,CAAYC,gBAAjB,EAAmC;AACjC;AACD;;AAED,UAAMC,SAAS,SAASP,qBAAqB,CAACG,GAAG,CAACK,GAAJ,CAAQC,OAAR,CAAgBC,MAAjB,CAA7C;;AALmC,wBAO0BX,cAAc,CAAC;AAC1EQ,MAAAA,SAD0E;AAE1EI,MAAAA,SAAS,EAAER,GAAG,CAACS,QAAJ,CAAaC,QAAb,EAF+D;AAG1EC,MAAAA,OAAO,EAAEX,GAAG,CAACK,GAAJ,CAAQO,cAAR,CAAuBC,QAAvB,CAAgC,CAAhC,CAHiE;AAI1EC,MAAAA,GAAG,EAAEd,GAAG,CAACK,GAAJ,CAAQC,OAAR,CAAgBQ,GAJqD;AAK1EP,MAAAA,MAAM,EAAEP,GAAG,CAACK,GAAJ,CAAQC,OAAR,CAAgBC,MALkD;AAM1ED,MAAAA,OAAO,EAAEN,GAAG,CAACK,GAAJ,CAAQC,OAAR,CAAgBS,cAAhB;AANiE,KAAD,CAPxC;AAAA,UAO3BC,WAP2B,SAO3BA,WAP2B;AAAA,UAOdC,eAPc,SAOdA,eAPc;AAAA,UAOGC,YAPH,SAOGA,YAPH;;AAenCjB,IAAAA,OAAO,CAACC,GAAR,CAAYiB,iBAAZ,GAAgCH,WAAhC;AACAf,IAAAA,OAAO,CAACC,GAAR,CAAYkB,qBAAZ,GAAoCH,eAApC;AACAhB,IAAAA,OAAO,CAACC,GAAR,CAAYmB,iBAAZ,GAAgCH,YAAhC;AACAlB,IAAAA,GAAG,CAACK,GAAJ,CAAQiB,GAAR,CAAYC,GAAZ,CAAgB,iDAAhB;AACD,GAnBD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["'use strict';\n\nconst { getCredentials, getAccessKeyForTenant } = require('@serverless/platform-sdk');\n\nmodule.exports = async function(ctx) {\n  if (!process.env.SLS_CLOUD_ACCESS) {\n    return;\n  }\n\n  const accessKey = await getAccessKeyForTenant(ctx.sls.service.tenant);\n\n  const { accessKeyId, secretAccessKey, sessionToken } = await getCredentials({\n    accessKey,\n    stageName: ctx.provider.getStage(),\n    command: ctx.sls.processedInput.commands[0],\n    app: ctx.sls.service.app,\n    tenant: ctx.sls.service.tenant,\n    service: ctx.sls.service.getServiceName(),\n  });\n  process.env.AWS_ACCESS_KEY_ID = accessKeyId;\n  process.env.AWS_SECRET_ACCESS_KEY = secretAccessKey;\n  process.env.AWS_SESSION_TOKEN = sessionToken;\n  ctx.sls.cli.log('Cloud credentials set from Serverless Platform.');\n};\n"],"file":"credentials.js"}